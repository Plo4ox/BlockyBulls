import{aS as q,aX as V,aN as d,j as e,aY as a,b5 as $,bv as Q,aT as M,a$ as F,aU as Y,c5 as K,bQ as E,ba as z,b6 as o,b0 as m,be as W,b2 as v,bJ as G,c6 as J,c7 as b,bD as U,aR as B,bf as X,c8 as Z,c2 as ee}from"./index-67021abe.js";import{o as ne,u as te,a as re}from"./useInAppWalletLocale-bbd27bfe.js";import{p as R,h as ie}from"./index-cb928f90.js";const O=q({animation:`${V} 0.15s ease-in`});function se(n){const u=n.value.split(""),h=c=>{n.setValue(c.join(""))},r=u.length,i=d.useRef([]);return d.useEffect(()=>{i.current[r]&&requestAnimationFrame(()=>{var c;(c=i.current[r])==null||c.focus()})},[r]),e.jsx(a,{center:"x",gap:"sm",flex:"row",children:new Array(n.digits).fill(null).map((c,s)=>e.jsx(oe,{"data-error":n.isInvalid,ref:t=>{i.current[s]=t},value:u[s]??"",type:"text",pattern:"[a-zA-Z0-9]*",variant:"outline",inputMode:"text",onPaste:t=>{const x=t.clipboardData.getData("text/plain").slice(0,n.digits).split("");h(x),t.preventDefault()},onKeyDown:t=>{var l,x;if(t.key==="Enter"&&n.onEnter){n.onEnter();return}if(t.key==="ArrowLeft"){if(s===0)return;(l=i.current[s-1])==null||l.focus();return}if(t.key==="ArrowRight"){if(s===n.digits-1)return;(x=i.current[s+1])==null||x.focus();return}if(t.key==="e"||t.key==="."){t.preventDefault();return}if(t.key==="Backspace"){if(s===0)return;const g=u.slice(0,-1);h(g)}},onChange:t=>{const l=t.target.value;if(l.length>1){h(l.split(""));return}if(!/\d/.test(l)&&l!==""){t.preventDefault();return}const x=[...u],g=s>r-1?r:s;x[g]=l,h(x)}},s))})}const oe=$(Q)(()=>{const n=M();return{appearance:"none",WebkitAppearance:"none",width:"40px",height:"40px",textAlign:"center",fontSize:F.md,padding:Y.xs,[K.mobile]:{width:"35px",height:"35px"},"&[data-verify-status='invalid']":{color:n.colors.danger,borderColor:n.colors.danger}}});function ae(n){const{wallet:u,done:h,goBack:r,userInfo:i}=n,{client:c,chain:s,connectModal:t}=E(),l=t.size==="wide",x=n.locale,[g,I]=d.useState(""),[S,p]=d.useState("idle"),[j,k]=d.useState("sending"),[T]=d.useState("base"),C=d.useCallback(async()=>{I(""),p("idle"),k("sending");try{if("email"in i){const f=await R({email:i.email,strategy:"email",client:c});k(f)}else if("phone"in i){const f=await R({phoneNumber:i.phone,strategy:"phone",client:c});k(f)}else throw new Error("Invalid userInfo")}catch(f){console.error(f),p("idle"),k("error")}},[c,i]);async function y(f){if("email"in i)await u.connect({chain:s,strategy:"email",email:i.email,verificationCode:f,client:c}),await b("email");else if("phone"in i)await u.connect({chain:s,strategy:"phone",phoneNumber:i.phone,verificationCode:f,client:c}),await b("phone");else throw new Error("Invalid userInfo")}const A=async f=>{var D;if(!(typeof j!="object"||f.length!==6)&&(p("idle"),typeof j=="object"&&u))try{if(p("verifying"),j.recoveryShareManagement==="USER_MANAGED"&&(j.isNewUser||j.isNewDevice))if(j.isNewUser)try{await y(f)}catch(w){if(!(w instanceof Error&&w.message.includes("encryption key")))throw w}else try{await y(f)}catch(w){if(!(w instanceof Error&&w.message.includes("encryption key")))throw w}else await y(f),h();p("valid")}catch(L){L instanceof Error&&((D=L==null?void 0:L.message)!=null&&D.includes("PAYMENT_METHOD_REQUIRED"))?p("payment_required"):p("invalid"),console.error("Authentication Error",L)}},P=d.useRef(!1);return d.useEffect(()=>{P.current||(P.current=!0,C())},[C]),T==="base"?e.jsxs(a,{fullHeight:!0,flex:"column",animate:"fadein",children:[e.jsx(a,{p:"lg",children:e.jsx(z,{title:x.signIn,onBack:r})}),e.jsx(a,{expand:!0,flex:"column",center:"y",children:e.jsxs("form",{onSubmit:f=>{f.preventDefault()},children:[e.jsxs(a,{flex:"column",center:"x",px:"lg",children:[!l&&e.jsx(o,{y:"xl"}),e.jsx(m,{children:x.emailLoginScreen.enterCodeSendTo}),e.jsx(o,{y:"sm"}),e.jsx(m,{color:"primaryText",children:"email"in i?i.email:i.phone}),e.jsx(o,{y:"xl"})]}),e.jsx(se,{isInvalid:S==="invalid",digits:6,value:g,setValue:f=>{I(f),p("idle"),A(f)},onEnter:()=>{A(g)}}),S==="invalid"&&e.jsxs(O,{children:[e.jsx(o,{y:"md"}),e.jsx(m,{size:"sm",color:"danger",center:!0,children:x.emailLoginScreen.invalidCode})]}),S==="payment_required"&&e.jsxs(O,{children:[e.jsx(o,{y:"md"}),e.jsx(m,{size:"sm",color:"danger",center:!0,children:x.maxAccountsExceeded})]}),e.jsx(o,{y:"xl"}),e.jsx(a,{px:l?"xxl":"lg",children:S==="verifying"?e.jsx(e.Fragment,{children:e.jsx(a,{flex:"row",center:"x",animate:"fadein",children:e.jsx(W,{size:"lg",color:"accentText"})})}):e.jsx(a,{animate:"fadein",children:e.jsx(v,{onClick:()=>A(g),variant:"accent",type:"submit",style:{width:"100%"},children:x.emailLoginScreen.verify})},"btn-container")}),e.jsx(o,{y:"xl"}),!l&&e.jsx(G,{}),e.jsxs(a,{p:l?void 0:"lg",children:[j==="error"&&e.jsx(e.Fragment,{children:e.jsx(m,{size:"sm",center:!0,color:"danger",children:x.emailLoginScreen.failedToSendCode})}),j==="sending"&&e.jsxs(a,{flex:"row",center:"both",gap:"xs",style:{textAlign:"center"},children:[e.jsx(m,{size:"sm",children:x.emailLoginScreen.sendingCode}),e.jsx(W,{size:"xs",color:"secondaryText"})]}),typeof j=="object"&&e.jsx(ce,{onClick:C,type:"button",children:x.emailLoginScreen.resendCode})]})]})})]}):null}const ce=J(()=>{const n=M();return{all:"unset",color:n.colors.accentText,fontSize:F.sm,cursor:"pointer",textAlign:"center",fontWeight:500,width:"100%","&:hover":{color:n.colors.primaryText}}}),N=n=>e.jsxs("svg",{width:n.size,height:n.size,viewBox:"0 0 36 36",fill:"none","aria-hidden":"true",children:[e.jsx("path",{d:"M18.0001 15C17.2045 15 16.4414 15.3161 15.8788 15.8787C15.3162 16.4413 15.0001 17.2044 15.0001 18C15.0001 19.53 14.8501 21.765 14.6101 24",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M21.0002 19.6801C21.0002 23.2501 21.0002 29.2501 19.5002 33.0001",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M25.9348 31.53C26.1148 30.63 26.5798 28.08 26.6848 27",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M2.99976 18C2.99976 14.8518 3.99032 11.7833 5.83112 9.22935C7.67193 6.67536 10.2697 4.76531 13.2563 3.76975C16.243 2.77419 19.4672 2.74359 22.4723 3.6823C25.4773 4.621 28.1108 6.48141 29.9998 9",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M2.99976 24H3.01628",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M32.7 24C33 21 32.8965 15.969 32.7 15",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M7.49976 29.25C8.24976 27 8.99976 22.5 8.99976 18C8.99824 16.9783 9.17071 15.9638 9.50976 15",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M12.9751 33C13.2901 32.01 13.6501 31.02 13.8301 30",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M13.5 10.2C14.8686 9.40988 16.4211 8.99401 18.0014 8.99426C19.5818 8.99452 21.1342 9.41088 22.5025 10.2015C23.8708 10.9921 25.0069 12.129 25.7964 13.498C26.5859 14.867 27.001 16.4197 27 18V21",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})]});function le(n){const{client:u,connectModal:h,chain:r}=E(),{wallet:i,done:c}=n,[s,t]=d.useState("loading"),l=d.useRef(!1);return d.useEffect(()=>{l.current||(l.current=!0,ie(u).then(x=>{t(x?"login":"select")}).catch(()=>{t("select")}))},[u]),e.jsxs(a,{animate:"fadein",fullHeight:!0,flex:"column",children:[e.jsx(a,{p:"lg",children:e.jsx(z,{title:"Passkey",onBack:n.onBack})}),e.jsx(a,{px:h.size==="wide"?"xxl":"lg",expand:!0,flex:"column",center:"y",children:e.jsxs("div",{children:[s==="loading"&&e.jsxs(e.Fragment,{children:[e.jsx(U,{}),e.jsx(o,{y:"xxl"})]}),s==="select"&&e.jsx(xe,{onSignin:()=>{t("login")},onSignup:()=>{t("signup")}}),s==="login"&&e.jsx(ue,{wallet:i,client:u,done:c,onCreate:()=>{t("signup")},chain:r}),s==="signup"&&e.jsx(de,{wallet:i,client:u,done:c,chain:r})]})})]})}function ue(n){const{wallet:u,done:h,client:r,chain:i}=n,[c,s]=d.useState("loading");async function t(){s("loading");try{await u.connect({client:r,strategy:"passkey",type:"sign-in",chain:i}),await b("passkey"),h()}catch{s("error")}}const l=d.useRef(!1);return d.useEffect(()=>{l.current||(l.current=!0,t())}),c==="loading"?e.jsx(_,{title:"Requesting Passkey",subtitle:"A pop-up prompt will appear to sign-in and verify your passkey"}):c==="error"?e.jsxs(e.Fragment,{children:[e.jsx(H,{onTryAgain:t,title:"Failed to Login"}),e.jsx(o,{y:"sm"}),e.jsx(v,{variant:"outline",fullWidth:!0,onClick:n.onCreate,children:"Create a new Passkey"}),e.jsx(o,{y:"lg"})]}):null}function de(n){const{wallet:u,done:h,client:r,chain:i}=n,[c,s]=d.useState("loading");async function t(){s("loading");try{await u.connect({client:r,strategy:"passkey",type:"sign-up",chain:i}),await b("passkey"),h()}catch{s("error")}}const l=d.useRef(!1);return d.useEffect(()=>{l.current||(l.current=!0,t())}),c==="loading"?e.jsx(_,{title:"Creating Passkey",subtitle:"A pop-up prompt will appear to sign-in and verify your passkey"}):c==="error"?e.jsxs(e.Fragment,{children:[e.jsx(H,{onTryAgain:t,title:"Failed to create passkey"}),e.jsx(o,{y:"lg"})]}):null}function xe(n){return e.jsxs(a,{children:[e.jsx(o,{y:"xxl"}),e.jsx(a,{flex:"row",center:"x",color:"accentText",children:e.jsx(N,{size:B["4xl"]})}),e.jsx(o,{y:"xl"}),e.jsx(o,{y:"xxl"}),e.jsx(v,{variant:"accent",onClick:n.onSignup,fullWidth:!0,children:"Create a Passkey"}),e.jsx(o,{y:"sm"}),e.jsx(v,{variant:"outline",onClick:n.onSignin,fullWidth:!0,children:"I have a Passkey"}),e.jsx(o,{y:"lg"})]})}function H(n){return e.jsxs(a,{animate:"fadein",children:[e.jsx(o,{y:"xxl"}),e.jsx(a,{flex:"row",center:"x",children:e.jsx(X,{size:B["3xl"]})}),e.jsx(o,{y:"lg"}),e.jsx(m,{center:!0,color:"primaryText",size:"lg",children:n.title}),e.jsx(o,{y:"xl"}),e.jsx(o,{y:"xxl"}),e.jsx(v,{variant:"accent",fullWidth:!0,onClick:n.onTryAgain,children:"Try Again"})]})}function _(n){return e.jsxs(a,{animate:"fadein",children:[e.jsx(o,{y:"xxl"}),e.jsxs(a,{flex:"row",center:"x",style:{position:"relative"},children:[e.jsx(W,{size:"4xl",color:"accentText"}),e.jsx(a,{color:"accentText",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:e.jsx(N,{size:B.xxl})})]}),e.jsx(o,{y:"xl"}),e.jsx(m,{center:!0,color:"primaryText",size:"lg",children:n.title}),e.jsx(o,{y:"md"}),e.jsx(m,{multiline:!0,center:!0,children:n.subtitle}),e.jsx(o,{y:"xxl"}),e.jsx(o,{y:"xxl"})]})}function he(n){var T;const u=n.locale,h=u.socialLoginScreen,r=M(),{connectModal:i}=E(),[c,s]=d.useState(void 0),{done:t,wallet:l}=n,[x,g]=d.useState("connecting"),{client:I,chain:S}=E(),p=async()=>{var C;try{const y=ne(n.socialAuth,r);if(!y)throw new Error(`Failed to open ${n.socialAuth} login window`);g("connecting"),await l.connect({chain:S,strategy:n.socialAuth,openedWindow:y,closeOpenedWindow:A=>{A.close()},client:I}),await b(n.socialAuth),g("connected"),t()}catch(y){g("error"),y instanceof Error&&((C=y==null?void 0:y.message)!=null&&C.includes("PAYMENT_METHOD_REQUIRED"))&&s(u.maxAccountsExceeded),console.error(`Error sign in with ${n.socialAuth}`,y)}},j=(T=n.state)==null?void 0:T.socialLogin,k=d.useRef(!1);return d.useEffect(()=>{k.current||j&&(k.current=!0,g("connecting"),j.connectionPromise.then(()=>{t(),g("connected")}).catch(()=>{g("error")}))},[t,j]),e.jsx(a,{animate:"fadein",flex:"column",fullHeight:!0,children:e.jsxs(a,{flex:"column",expand:!0,p:"lg",style:{paddingBottom:0},children:[n.goBack&&e.jsx(z,{title:h.title,onBack:n.goBack}),i.size==="compact"?e.jsx(o,{y:"xl"}):null,e.jsxs(a,{flex:"column",center:"both",expand:!0,style:{textAlign:"center",minHeight:"250px"},children:[x!=="error"&&e.jsxs(a,{animate:"fadein",children:[e.jsx(m,{color:"primaryText",center:!0,multiline:!0,style:{maxWidth:"250px"},children:h.instruction}),e.jsx(o,{y:"xl"}),e.jsx(a,{center:"x",flex:"row",children:e.jsx(W,{size:"lg",color:"accentText"})}),e.jsx(o,{y:"xxl"})]}),x==="error"&&e.jsxs(a,{animate:"fadein",children:[e.jsx(m,{color:"danger",children:h.failed}),c&&e.jsx(m,{color:"danger",children:c}),e.jsx(o,{y:"lg"}),e.jsx(v,{variant:"primary",onClick:p,children:h.retry}),e.jsx(o,{y:"xxl"})]})]})]})})}function ye(n){const u=Z(),h=ee(),r=u,i=te(),{connectModal:c}=E();if(!i)return e.jsx(U,{});const s=c.size==="compact"?n.goBack:()=>{h({})},t=r!=null&&r.emailLogin?{email:r.emailLogin}:r!=null&&r.phoneLogin?{phone:r.phoneLogin}:void 0;return t?e.jsx(ae,{userInfo:t,locale:i,done:n.done,goBack:s,wallet:n.wallet}):r!=null&&r.passkeyLogin?e.jsx(le,{wallet:n.wallet,done:n.done,onBack:s}):r!=null&&r.socialLogin?e.jsx(he,{socialAuth:r.socialLogin.type,locale:i,done:n.done,goBack:s,wallet:n.wallet,state:r}):e.jsx(re,{select:()=>{},locale:i,done:n.done,goBack:n.goBack,wallet:n.wallet})}export{ye as default};

import{aK as Re,aL as Qe,aM as Ve,M as $e,g as Te,aN as y,j as t,aO as Ue,aP as He,aQ as Ye,aR as k,aS as Ie,aT as K,aU as A,aV as $,aW as Ke,aX as Ge,aY as u,aZ as Ze,a_ as q,a$ as R,b0 as f,b1 as Je,b2 as D,b3 as X,b4 as V,b5 as ee,b6 as l,b7 as Xe,b8 as et,b9 as tt,ba as De,bb as nt,bc as ot,bd as it,be as te,p as st,bf as at,bg as rt,bh as ct,bi as ke,bj as Me,bk as dt,bl as lt,bm as G,bn as ut,bo as O,av as _,bp as ht,bq as ze,br as xt,bs as H,bt as mt,bu as ne,bv as ft,bw as J,bx as Y,by as Pe,bz as Le,bA as yt,bB as bt,bC as gt,bD as jt,bE as wt,bF as St,bG as Fe,bH as Ct,bI as Tt,bJ as Be,bK as kt,bL as Ft,bM as Bt,bN as At,bO as Et}from"./index-67021abe.js";function Wt(e,n){return Re({...n,queryKey:["buyWithCryptoQuote",e],queryFn:()=>{if(!e)throw new Error("Swap params are required");return Qe(e)},enabled:!!e,retry(s,i){return!(s>3||i.message.includes("Minimum purchase"))}})}async function vt(e){try{const n=new URLSearchParams({toAddress:e.toAddress,fromCurrencySymbol:e.fromCurrencySymbol,toChainId:e.toChainId.toString(),toTokenAddress:e.toTokenAddress.toLowerCase()});e.fromAmount&&n.append("fromAmount",e.fromAmount),e.toAmount&&n.append("toAmount",e.toAmount),e.maxSlippageBPS&&n.append("maxSlippageBPS",e.maxSlippageBPS.toString()),e.isTestMode&&n.append("isTestMode",e.isTestMode.toString());const s=n.toString(),i=`${Ve()}?${s}`,o=await $e(e.client)(i);if(!o.ok){const a=await o.json();throw a&&"error"in a?a:new Error(`HTTP error! status: ${o.status}`)}return(await o.json()).result}catch(n){throw console.error("Fetch error:",n),n}}function Rt(e,n){return Re({...n,queryKey:["useBuyWithFiatQuote",e],queryFn:async()=>{if(!e)throw new Error("No params provided");return vt(e)},enabled:!!e,retry(s,i){if(s>3)return!1;try{if(i.error.code==="MINIMUM_PURCHASE_AMOUNT")return!1}catch{return!0}return!0}})}function Ne(e){const n=e.toToken.chainId===e.onRampToken.token.chainId,s=Te(e.toToken.tokenAddress)===Te(e.onRampToken.token.tokenAddress);return!(n&&s)}const It=y.forwardRef(function(n,s){return t.jsx(t.Fragment,{children:t.jsxs(Dt,{ref:s,children:[t.jsx(Ue,{children:t.jsx(He,{type:"button","aria-label":"Close",onClick:n.close,children:t.jsx(Ye,{width:k.md,height:k.md,style:{color:"inherit"}})})}),n.children]})})}),Dt=Ie(()=>{const e=K();return{zIndex:1e4,padding:A.lg,borderTopLeftRadius:$.xl,borderTopRightRadius:$.xl,background:e.colors.modalBg,position:"absolute",bottom:0,left:0,right:0,animation:`${Mt} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.1)`,borderTop:`1px solid ${e.colors.borderColor}`}}),Mt=Ke`
  from {
    opacity: 0;
    transform: translateY(100px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
`,zt=Ie(()=>({backgroundColor:K().colors.modalOverlayBg,zIndex:9999,position:"absolute",inset:0,animation:`${Ge} 400ms cubic-bezier(0.16, 1, 0.3, 1)`}));function Pt(){const e=y.useRef(null),n=y.useRef(null);return{drawerRef:e,drawerOverlayRef:n,onClose:i=>{var o;if(e.current){const a={easing:"cubic-bezier(0.175, 0.885, 0.32, 1.1)",fill:"forwards",duration:300},c=e.current.animate([{transform:"translateY(100%)",opacity:0}],a);(o=n.current)==null||o.animate([{opacity:0}],a),c.onfinish=i}else i()}}}function qe(e){const{estimatedSeconds:n,quoteIsLoading:s}=e;return t.jsxs(u,{bg:"tertiaryBg",flex:"row",borderColor:"borderColor",style:{borderRadius:$.md,borderTopLeftRadius:0,borderTopRightRadius:0,justifyContent:"space-between",alignItems:"center",borderWidth:"1px",borderStyle:"solid"},children:[t.jsxs(u,{flex:"row",center:"y",gap:"xxs",color:"accentText",p:"sm",children:[t.jsx(Ze,{width:k.sm,height:k.sm}),s?t.jsx(q,{height:R.xs,width:"50px",color:"borderColor"}):t.jsx(f,{size:"xs",color:"secondaryText",children:n!==void 0?`~${Je(n)}`:"--"})]}),t.jsxs(D,{variant:"ghost",onClick:e.onViewFees,gap:"xs",children:[t.jsx(u,{color:"accentText",flex:"row",center:"both",children:t.jsx(Lt,{size:k.sm})}),t.jsx(f,{size:"xs",color:"secondaryText",children:"View Fees"})]})]})}const Lt=e=>t.jsxs("svg",{width:e.size,height:e.size,viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[t.jsx("path",{d:"M9.5 1.5H2.5C1.94772 1.5 1.5 1.94772 1.5 2.5V9.5C1.5 10.0523 1.94772 10.5 2.5 10.5H9.5C10.0523 10.5 10.5 10.0523 10.5 9.5V2.5C10.5 1.94772 10.0523 1.5 9.5 1.5Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),t.jsx("path",{d:"M4.5 7.5L7.5 4.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})]});function Nt(e){return t.jsxs(u,{bg:"tertiaryBg",borderColor:"borderColor",flex:"row",style:{borderRadius:$.md,borderBottomRightRadius:0,borderBottomLeftRadius:0,borderWidth:"1px",borderStyle:"solid",borderBottom:"none",flexWrap:"nowrap",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(qt,{disabled:e.disableCurrencySelection,variant:"ghost",onClick:e.onSelectCurrency,style:{minHeight:"64px",justifyContent:"flex-start",minWidth:"50%"},gap:"sm",children:[t.jsx(e.currency.icon,{size:k.md}),t.jsxs(u,{flex:"row",center:"y",gap:"xxs",children:[t.jsx(f,{color:"primaryText",children:e.currency.shorthand}),!e.disableCurrencySelection&&t.jsx(X,{width:k.sm,height:k.sm})]})]}),t.jsx("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:A.xxs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",justifyContent:"center",paddingRight:A.sm},children:e.isLoading?t.jsx(q,{width:"100px",height:R.lg}):t.jsx(f,{size:"lg",color:e.value?"primaryText":"secondaryText",children:e.value?`${V(Number(e.value),4)}`:"--"})})]})}const qt=ee(D)(()=>({"&[disabled]:hover":{borderColor:"transparent"}}));function Ot(e){return t.jsxs("div",{children:[t.jsx(f,{size:"sm",children:"Pay with "}),t.jsx(l,{y:"xs"}),t.jsxs(u,{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gridGap:A.sm},children:[t.jsx(Ae,{isChecked:e.selected==="creditCard",variant:"outline",onClick:()=>{e.onSelect("creditCard")},children:"Credit Card"}),t.jsx(Ae,{isChecked:e.selected==="crypto",variant:"outline",onClick:()=>{e.onSelect("crypto")},children:"Crypto"})]})]})}const Ae=ee(D)(e=>{const n=K();return{fontSize:R.sm,borderColor:e.isChecked?n.colors.accentText:n.colors.borderColor,"&:hover":{borderColor:e.isChecked?n.colors.accentText:n.colors.secondaryText},gap:A.xs,paddingInline:A.xxs,paddingBlock:A.sm,width:"100%"}});function Oe(e,n){const o=(window.innerHeight-750)/2,a=(window.innerWidth-500)/2;return window.open(`${e}&theme=${n}`,"thirdweb Pay",`width=500, height=750, top=${o}, left=${a}`)}function _t(e){var c,h,x,b;const n=Xe(),{openedWindow:s}=e,i=et({intentId:e.intentId,client:e.client});let o="loading";((c=i.data)==null?void 0:c.status)==="ON_RAMP_TRANSFER_FAILED"||((h=i.data)==null?void 0:h.status)==="PAYMENT_FAILED"?o="failed":((x=i.data)==null?void 0:x.status)==="CRYPTO_SWAP_FALLBACK"?o="partialSuccess":((b=i.data)==null?void 0:b.status)==="ON_RAMP_TRANSFER_COMPLETED"&&(o="completed"),y.useEffect(()=>{var r,d;!s||!i.data||(((r=i.data)==null?void 0:r.status)==="CRYPTO_SWAP_REQUIRED"||((d=i.data)==null?void 0:d.status)==="ON_RAMP_TRANSFER_COMPLETED")&&s.close()},[i.data,s]);const a=y.useRef(!1);return y.useEffect(()=>{var r;!a.current&&((r=i.data)==null?void 0:r.status)==="ON_RAMP_TRANSFER_COMPLETED"&&(a.current=!0,tt(n))},[i.data,n]),y.useEffect(()=>{var r;((r=i.data)==null?void 0:r.status)==="CRYPTO_SWAP_REQUIRED"&&e.onShowSwapFlow(i.data)},[i.data,e.onShowSwapFlow]),t.jsxs(u,{p:"lg",children:[t.jsx(De,{title:"Buy",onBack:e.onBack}),e.hasTwoSteps&&t.jsxs(t.Fragment,{children:[t.jsx(l,{y:"lg"}),t.jsx(nt,{steps:2,currentStep:1}),t.jsx(l,{y:"sm"}),t.jsxs(f,{size:"xs",children:["Step 1 of 2 - Buying ",e.quote.onRampToken.token.symbol," with"," ",e.quote.fromCurrencyWithFees.currencySymbol]})]}),t.jsx(pt,{uiStatus:o,onDone:e.onDone,fiatStatus:i.data,client:e.client,isBuyForTx:e.isBuyForTx,quote:e.quote,isEmbed:e.isEmbed})]})}function pt(e){const{uiStatus:n}=e,s=e.fiatStatus?ot(e.fiatStatus):void 0,i=e.fiatStatus&&e.fiatStatus.status!=="NOT_FOUND"?e.fiatStatus:void 0,o=e.quote.onRampToken,a=t.jsx(it,{client:e.client,token:i!=null&&i.source?{chainId:i.source.token.chainId,address:i.source.token.tokenAddress,symbol:i.source.token.symbol||"",amount:i.source.amount}:{chainId:o.token.chainId,address:o.token.tokenAddress,symbol:o.token.symbol,amount:o.amount},fiat:{amount:e.quote.fromCurrencyWithFees.amount,currencySymbol:e.quote.fromCurrencyWithFees.currencySymbol},statusMeta:i!=null&&i.source&&s?{color:s==null?void 0:s.color,text:s==null?void 0:s.status,txHash:i.source.transactionHash}:void 0});return t.jsxs(u,{children:[t.jsx(l,{y:"xl"}),n==="loading"&&t.jsxs(t.Fragment,{children:[t.jsx(l,{y:"md"}),t.jsx(u,{flex:"row",center:"x",children:t.jsx(te,{size:"3xl",color:"accentText"})}),t.jsx(l,{y:"md"}),t.jsx(f,{color:"primaryText",size:"lg",center:!0,children:"Buy Pending"}),t.jsx(l,{y:"sm"}),!st()&&t.jsx(f,{center:!0,children:"Complete the purchase in popup"}),t.jsx(l,{y:"xxl"}),a]}),n==="failed"&&t.jsxs(t.Fragment,{children:[t.jsx(l,{y:"md"}),t.jsx(u,{flex:"row",center:"x",children:t.jsx(at,{size:k["3xl"]})}),t.jsx(l,{y:"lg"}),t.jsx(f,{color:"primaryText",size:"lg",center:!0,children:"Transaction Failed"}),t.jsx(l,{y:"xxl"}),a]}),n==="completed"&&t.jsxs(t.Fragment,{children:[t.jsx(l,{y:"md"}),t.jsx(u,{flex:"row",center:"x",color:"success",children:t.jsx(rt,{width:k["3xl"],height:k["3xl"]})}),t.jsx(l,{y:"md"}),t.jsx(f,{color:"primaryText",size:"lg",center:!0,children:"Buy Complete"}),e.fiatStatus&&e.fiatStatus.status!=="NOT_FOUND"&&t.jsxs(t.Fragment,{children:[t.jsx(l,{y:"xxl"}),a,t.jsx(l,{y:"sm"})]}),!e.isEmbed&&t.jsx(D,{variant:"accent",fullWidth:!0,onClick:e.onDone,children:e.isBuyForTx?"Continue Transaction":"Done"})]})]})}function Qt(e){const n=Ne(e.quote),[s,i]=y.useState(n?{id:"step-1"}:{id:"onramp-status"}),[o,a]=y.useState(e.openedWindow);return s.id==="step-1"?t.jsx(ct,{client:e.client,onBack:e.onBack,partialQuote:ke(e.quote),step:1,onContinue:()=>{const c=Oe(e.quote.onRampLink,e.theme);Me({type:"fiat",intentId:e.quote.intentId}),a(c),i({id:"onramp-status"})}}):s.id==="onramp-status"?t.jsx(_t,{client:e.client,intentId:e.quote.intentId,onBack:e.onBack,onViewPendingTx:e.onViewPendingTx,hasTwoSteps:n,openedWindow:o,quote:e.quote,onDone:e.onDone,onShowSwapFlow:c=>{i({id:"postonramp-swap",data:c})},isBuyForTx:e.isBuyForTx,isEmbed:e.isEmbed}):s.id==="postonramp-swap"?t.jsx(dt,{status:s.data,quote:ke(e.quote),client:e.client,onBack:e.onBack,onViewPendingTx:e.onViewPendingTx,onDone:e.onDone,onSwapFlowStarted:()=>{},isBuyForTx:e.isBuyForTx,isEmbed:e.isEmbed}):null}function Vt(e){const{buyForTx:n,hasEditedAmount:s,isMainScreen:i,setTokenAmount:o,account:a}=e,c=!s&&i,h=!i,[x,b]=y.useState(n==null?void 0:n.cost);return y.useEffect(()=>{if(!n||h)return;let r=!0;async function d(){if(!(!n||!r)){try{const j=await lt(n.tx,a);if(!r)return;if(b(j),c&&j>n.balance){const B=String(V(Number(G(j-n.balance)),4));o(B)}}catch{}await ut(3e4),d()}}return d(),()=>{r=!1}},[n,c,o,h,a]),{amountNeeded:x}}function $t(e){const{payOptions:n,supportedDestinations:s,toChain:i,toToken:o,method:a,setMethod:c}=e;function h(){const B=s.find(C=>C.chain.id===i.id);if(!B)return{fiat:!0,swap:!0};const m=O(o)?_:o.address,S=B.tokens.find(C=>C.address.toLowerCase()===m.toLowerCase());return S?{fiat:S.buyWithFiatEnabled,swap:S.buyWithCryptoEnabled}:{fiat:!0,swap:!0}}const{fiat:x,swap:b}=h(),r=n.buyWithFiat!==!1&&x,d=n.buyWithCrypto!==!1&&b;return y.useEffect(()=>{!r&&!d||(a==="creditCard"&&!r&&c("crypto"),a==="crypto"&&!d&&c("creditCard"))},[r,d,a,c]),{showPaymentSelection:r&&d}}const Ee=ht({id:137,name:"Polygon",nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},blockExplorers:[{name:"PolygonScan",url:"https://polygonscan.com",apiUrl:"https://api.polygonscan.com/api"}]});function Ut(e){var M,p,g,z,P,E,L,W;const n=ze(),{payOptions:s,buyForTx:i,supportedDestinations:o}=e,a=((M=s.prefillBuy)==null?void 0:M.amount)||(i?String(V(Number(G(i.cost-i.balance)),4)):""),[c,h]=y.useState(!1),[x,b]=y.useState(a),r=xt(x,300),[d,j]=y.useState(((p=s.prefillBuy)==null?void 0:p.chain)||(i==null?void 0:i.tx.chain)||((g=o.find(N=>N.chain.id===(n==null?void 0:n.id)))==null?void 0:g.chain)||Ee),[B,m]=y.useState(((z=s.prefillBuy)==null?void 0:z.token)||H),[S,C]=y.useState(s.buyWithCrypto!==!1&&((E=(P=s.buyWithCrypto)==null?void 0:P.prefillSource)==null?void 0:E.chain)||Ee),[T,F]=y.useState(s.buyWithCrypto!==!1&&((W=(L=s.buyWithCrypto)==null?void 0:L.prefillSource)==null?void 0:W.token)||H);return{tokenAmount:x,setTokenAmount:b,hasEditedAmount:c,toChain:d,setToChain:j,deferredTokenAmount:r,fromChain:S,setFromChain:C,toToken:B,setToToken:m,fromToken:T,setFromToken:F,selectedCurrency:mt,setHasEditedAmount:h}}function Ht(e){var i;const n=ne(e.chain),s=()=>{let o=e.value.replace(".","").length;return e.value.includes(".")&&(o+=.3),`calc(${`${Math.max(1,o)}ch`} + 6px)`};return t.jsxs(u,{children:[t.jsx("div",{onClick:o=>{var a;(a=o.currentTarget.querySelector("input"))==null||a.focus()},children:t.jsxs(u,{flex:"row",center:"both",gap:"xs",style:{flexWrap:"nowrap"},children:[t.jsx(ft,{variant:"outline",pattern:"^[0-9]*[.,]?[0-9]*$",inputMode:"decimal",placeholder:"0",type:"text","data-placeholder":e.value==="",value:e.value||"0",disabled:e.freezeAmount,onClick:o=>{e.value===""&&o.currentTarget.setSelectionRange(o.currentTarget.value.length,o.currentTarget.value.length)},onChange:o=>{let a=o.target.value;a.startsWith(".")&&(a=`0${a}`);const c=Number(a);Number.isNaN(c)||(a.startsWith("0")&&!a.startsWith("0.")?e.onChange(a.slice(1)):e.onChange(a))},style:{border:"none",fontSize:e.value.length>10?"26px":e.value.length>6?"34px":"50px",boxShadow:"none",padding:"0",paddingBlock:"2px",fontWeight:600,textAlign:"right",width:s(),maxWidth:"calc(100% - 100px)"}}),t.jsx(J,{token:e.token,chain:e.chain,size:"lg",color:"secondaryText"})]})}),!e.hideTokenSelector&&t.jsxs(t.Fragment,{children:[t.jsx(l,{y:"sm"}),t.jsx(u,{flex:"row",center:"x",children:t.jsxs(Yt,{variant:"secondary",fullWidth:!0,style:{fontSize:R.sm},gap:"xxs",onClick:e.onSelectToken,disabled:e.freezeChainAndToken,children:[t.jsxs(u,{flex:"row",center:"y",gap:"sm",children:[t.jsx(Y,{token:e.token,chain:e.chain,size:"md",client:e.client}),t.jsxs(u,{flex:"column",style:{gap:"4px"},children:[t.jsx(J,{token:e.token,chain:e.chain,size:"sm"}),(i=n.data)!=null&&i.name?t.jsx(f,{size:"xs",color:"secondaryText",children:n.data.name}):t.jsx(q,{width:"90px",height:R.xs})]})]}),t.jsx(X,{width:k.sm,height:k.sm,style:{marginLeft:"auto"}})]})})]})]})}const Yt=ee(D)(()=>{const e=K();return{background:e.colors.tertiaryBg,border:`1px solid ${e.colors.borderColor}`,justifyContent:"flex-start",transition:"background 0.3s",padding:A.sm}});function Kt(e){var o;const n=ne(e.chain),s=Pe(),i=Le({address:s==null?void 0:s.address,chain:e.chain,tokenAddress:O(e.token)?void 0:e.token.address,client:e.client});return t.jsxs(u,{bg:"tertiaryBg",borderColor:"borderColor",flex:"row",style:{borderRadius:$.md,borderBottomRightRadius:0,borderBottomLeftRadius:0,borderWidth:"1px",borderStyle:"solid",borderBottom:"none",flexWrap:"nowrap",justifyContent:"space-between",minHeight:"64px",alignItems:"center"},children:[t.jsxs(D,{variant:"ghost",onClick:e.onSelectToken,gap:"sm",style:{paddingInline:A.sm,paddingBlock:A.sm,minWidth:"50%",justifyContent:"flex-start"},disabled:e.freezeChainAndTokenSelection,children:[t.jsx(Y,{token:e.token,chain:e.chain,size:"md",client:e.client}),t.jsxs(u,{flex:"column",gap:"xxs",children:[t.jsxs(u,{flex:"row",gap:"xs",center:"y",color:"primaryText",children:[t.jsx(J,{token:e.token,chain:e.chain,size:"sm"}),t.jsx(X,{width:k.sm,height:k.sm})]}),(o=n.data)!=null&&o.name?t.jsxs(f,{size:"xs",children:[" ",n.data.name]}):t.jsx(q,{width:"90px",height:R.xs})]})]}),t.jsxs("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:A.xxs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",justifyContent:"center",paddingRight:A.sm},children:[e.isLoading?t.jsx(q,{width:"120px",height:R.md,color:"borderColor"}):t.jsx(f,{size:"md",color:e.value?"primaryText":"secondaryText",style:{},children:V(Number(e.value),4)||"--"}),t.jsxs(u,{flex:"row",gap:"xxs",center:"y",color:"secondaryText",children:[t.jsx(yt,{size:R.xs}),i.data?t.jsx(f,{size:"xs",color:"secondaryText",weight:500,children:bt(i.data,!0)}):t.jsx(q,{width:"70px",height:R.xs})]})]})]})}function nn(e){const n=gt(e.client);return n.data?t.jsx(Zt,{...e,onViewPendingTx:e.onViewPendingTx,supportedDestinations:n.data,buyForTx:e.buyForTx}):t.jsx(jt,{})}function Gt(e){const{payOptions:n}=e,[s,i]=y.useState(n.buyWithCrypto===!1?"creditCard":n.buyWithFiat===!1?"crypto":"creditCard"),[o,a]=y.useState({type:"main"}),[c,h]=y.useState(),{drawerRef:x,drawerOverlayRef:b,onClose:r}=Pt();function d(){r(()=>{h(void 0)})}function j(){a({type:"main"})}return{method:s,setMethod:i,screen:o,setScreen:a,drawerScreen:c,setDrawerScreen:h,drawerRef:x,drawerOverlayRef:b,closeDrawer:d,showMainScreen:j}}function Zt(e){var re,ce,de,le,ue,he,xe,me,fe,ye,be,ge,je,we,Se,Ce;const{client:n,supportedDestinations:s,connectLocale:i,payOptions:o,buyForTx:a}=e,c=Pe(),h=ze();wt(s.map(v=>v.chain)||[],50);const{method:x,setMethod:b,screen:r,setScreen:d,drawerScreen:j,setDrawerScreen:B,drawerRef:m,drawerOverlayRef:S,closeDrawer:C,showMainScreen:T}=Gt({payOptions:o}),{tokenAmount:F,setTokenAmount:I,setHasEditedAmount:M,hasEditedAmount:p,toChain:g,setToChain:z,deferredTokenAmount:P,fromChain:E,setFromChain:L,toToken:W,setToToken:N,fromToken:U,setFromToken:oe,selectedCurrency:_e}=Ut({payOptions:o,buyForTx:a,supportedDestinations:s}),{amountNeeded:ie}=Vt({setTokenAmount:I,buyForTx:a,hasEditedAmount:p,isMainScreen:r.type==="main",account:c}),Z=h&&F,Q=St({client:e.client,destinationChainId:g.id,destinationTokenAddress:O(W)?_:W.address}),pe=y.useMemo(()=>We(s,o,e.supportedTokens),[e.supportedTokens,s,o]),se=y.useMemo(()=>{if(Q.data)return We(Q.data,o,e.supportedTokens)},[e.supportedTokens,Q.data,o]),{showPaymentSelection:ae}=$t({payOptions:o,supportedDestinations:s,toChain:g,toToken:W,method:x,setMethod:b});if(r.type==="node")return r.node;if(r.type==="screen-id"&&r.name==="select-to-token"){const v=s.map(w=>w.chain);return((ce=(re=o.prefillBuy)==null?void 0:re.allowEdits)==null?void 0:ce.token)===!1?t.jsx(ve,{chains:v,client:e.client,connectLocale:e.connectLocale,setChain:z,showMainScreen:T}):t.jsx(Fe,{onBack:T,tokenList:((g!=null&&g.id?pe[g.id]:void 0)||[]).filter(w=>w.address!==_),onTokenSelect:w=>{N(w),T()},chain:g,chainSelection:((le=(de=o.prefillBuy)==null?void 0:de.allowEdits)==null?void 0:le.chain)!==!1?{chains:v,select:w=>{z(w)}}:void 0,connectLocale:i,client:n})}if(r.type==="screen-id"&&r.name==="select-from-token"&&Q.data&&se){const v=Q.data.map(w=>w.chain);return o.buyWithCrypto!==!1&&((xe=(he=(ue=o.buyWithCrypto)==null?void 0:ue.prefillSource)==null?void 0:he.allowEdits)==null?void 0:xe.token)===!1?t.jsx(ve,{chains:v,client:e.client,connectLocale:e.connectLocale,setChain:L,showMainScreen:T}):t.jsx(Fe,{onBack:T,tokenList:((E!=null&&E.id?se[E.id]:void 0)||[]).filter(w=>w.address!==_),onTokenSelect:w=>{oe(w),d({type:"main"})},chain:E,chainSelection:o.buyWithCrypto!==!1&&((ye=(fe=(me=o.buyWithCrypto)==null?void 0:me.prefillSource)==null?void 0:fe.allowEdits)==null?void 0:ye.chain)!==!1?{chains:Q.data.map(w=>w.chain),select:w=>L(w)}:void 0,connectLocale:i,client:n})}return t.jsx(u,{animate:"fadein",children:t.jsxs("div",{onClick:v=>{j&&m.current&&!m.current.contains(v.target)&&(v.preventDefault(),v.stopPropagation(),C())},children:[j&&t.jsxs(t.Fragment,{children:[t.jsx(zt,{ref:S}),t.jsx(It,{ref:m,close:C,children:t.jsx(Ct,{children:j})})]}),t.jsxs(u,{p:"lg",style:{paddingBottom:0},children:[t.jsx(De,{title:e.buyForTx?`Not enough ${e.buyForTx.tokenSymbol}`:"Buy",onBack:e.onBack}),t.jsx(l,{y:"lg"}),!Z&&t.jsx(l,{y:"xl"}),ie&&e.buyForTx?t.jsx(en,{amountNeeded:String(V(Number(G(ie)),4)),buyForTx:e.buyForTx,client:n}):null,t.jsx(Ht,{value:F,onChange:async v=>{M(!0),I(v)},freezeAmount:((ge=(be=o.prefillBuy)==null?void 0:be.allowEdits)==null?void 0:ge.amount)===!1,freezeChainAndToken:((we=(je=o.prefillBuy)==null?void 0:je.allowEdits)==null?void 0:we.chain)===!1&&((Ce=(Se=o.prefillBuy)==null?void 0:Se.allowEdits)==null?void 0:Ce.token)===!1,token:W,chain:g,onSelectToken:()=>{d({type:"screen-id",name:"select-to-token"})},client:e.client,hideTokenSelector:!!e.buyForTx})]}),ae?t.jsx(l,{y:"lg"}):t.jsx(l,{y:"md"}),Z&&t.jsxs(t.Fragment,{children:[ae&&t.jsxs(u,{px:"lg",children:[t.jsx(Ot,{selected:x,onSelect:b}),t.jsx(l,{y:"md"})]}),x==="crypto"&&c&&h&&t.jsx(Jt,{...e,setScreen:d,setDrawerScreen:B,tokenAmount:P,toChain:g,toToken:W,fromChain:E,fromToken:U,showFromTokenSelector:()=>{d({type:"screen-id",name:"select-from-token"})},account:c,activeChain:h}),x==="creditCard"&&c&&t.jsx(Xt,{...e,setScreen:d,setDrawerScreen:B,tokenAmount:P,toChain:g,toToken:W,closeDrawer:C,selectedCurrency:_e,showCurrencySelector:()=>{},account:c}),t.jsx(l,{y:"sm"})]}),t.jsxs(u,{px:"lg",flex:"column",gap:"sm",children:[!Z&&t.jsx(t.Fragment,{children:!c&&e.connectButton?t.jsx("div",{children:e.connectButton}):t.jsx(D,{variant:"accent",fullWidth:!0,disabled:!0,"data-disable":!0,children:"Continue"})}),c&&t.jsx(D,{variant:"outline",fullWidth:!0,style:{padding:A.xs,fontSize:R.sm},onClick:e.onViewPendingTx,children:"View all transactions"})]}),t.jsx(l,{y:"lg"})]})})}function Jt(e){var z,P,E,L,W;const{setDrawerScreen:n,setScreen:s,account:i,client:o,toChain:a,tokenAmount:c,toToken:h,fromChain:x,fromToken:b,showFromTokenSelector:r,payOptions:d}=e,j=Le({address:i.address,chain:x,tokenAddress:O(b)?void 0:b.address,client:o}),B=c&&!(x.id===a.id&&b===h)?{fromAddress:i.address,fromChainId:x.id,fromTokenAddress:O(b)?_:b.address,toChainId:a.id,toTokenAddress:O(h)?_:h.address,toAmount:c,client:o}:void 0,m=Wt(B,{staleTime:30*1e3,refetchInterval:30*1e3,gcTime:30*1e3}),S=(z=m.data)==null?void 0:z.swapDetails.fromAmount,C=!!S&&!!j.data&&Number(j.data.displayValue)<Number(S),T=!m.data||C,F=e.activeChain.id!==x.id;function I(N){const U="Unable to get price quote";try{return N instanceof Error&&N.message.includes("Minimum")?N.message.replace("Fetch failed: Error: ",""):U}catch{return U}}function M(){m.data&&s({type:"node",node:t.jsx(Bt,{isBuyForTx:!!e.buyForTx,isEmbed:e.isEmbed,client:o,onBack:()=>{s({type:"main"})},buyWithCryptoQuote:m.data,account:i,onViewPendingTx:e.onViewPendingTx,isFiatFlow:!1,onDone:e.onDone,onTryAgain:()=>{s({type:"main"}),m.refetch()}})})}function p(){m.data&&n(t.jsxs("div",{children:[t.jsx(f,{size:"lg",color:"primaryText",children:"Fees"}),t.jsx(l,{y:"lg"}),t.jsx(At,{quote:m.data,align:"left"})]}))}const g=d.buyWithCrypto!==!1?(P=d.buyWithCrypto)==null?void 0:P.prefillSource:void 0;return t.jsxs(u,{px:"lg",flex:"column",gap:"md",children:[t.jsxs("div",{children:[t.jsx(Kt,{value:S||"",onSelectToken:r,chain:x,token:b,isLoading:m.isLoading&&!S,client:o,freezeChainAndTokenSelection:((E=g==null?void 0:g.allowEdits)==null?void 0:E.chain)===!1&&((L=g==null?void 0:g.allowEdits)==null?void 0:L.token)===!1}),t.jsx(qe,{quoteIsLoading:m.isLoading,estimatedSeconds:(W=m.data)==null?void 0:W.swapDetails.estimated.durationSeconds,onViewFees:p})]}),m.error&&t.jsx(f,{color:"danger",size:"sm",center:!0,children:I(m.error)}),F&&!m.isLoading&&!C&&!m.error?t.jsx(Tt,{variant:"accent",fullWidth:!0,chain:x}):t.jsx(D,{variant:T?"outline":"accent",fullWidth:!0,"data-disabled":T,disabled:T,onClick:async()=>{T||M()},gap:"xs",children:C?t.jsx(f,{color:"danger",children:"Not Enough Funds"}):m.isLoading?t.jsxs(t.Fragment,{children:[t.jsx(te,{size:"sm",color:"accentText"}),"Getting price quote"]}):"Continue"})]})}function Xt(e){var C,T;const{toToken:n,tokenAmount:s,account:i,client:o,setScreen:a,setDrawerScreen:c,toChain:h,showCurrencySelector:x,selectedCurrency:b}=e,r=e.payOptions.buyWithFiat,d=Rt(r!==!1&&s?{fromCurrencySymbol:"USD",toChainId:h.id,toAddress:i.address,toTokenAddress:O(n)?_:n.address,toAmount:s,client:o,isTestMode:r==null?void 0:r.testMode}:void 0);function j(){if(!d.data)return;const F=Ne(d.data);let I=null;F||(I=Oe(d.data.onRampLink,typeof e.theme=="string"?e.theme:e.theme.type),Me({type:"fiat",intentId:d.data.intentId})),a({type:"node",node:t.jsx(Qt,{isBuyForTx:!!e.buyForTx,quote:d.data,onBack:()=>{a({type:"main"})},client:o,testMode:r!==!1&&(r==null?void 0:r.testMode)||!1,theme:typeof e.theme=="string"?e.theme:e.theme.type,onViewPendingTx:e.onViewPendingTx,openedWindow:I,onDone:e.onDone,isEmbed:e.isEmbed})})}function B(){d.data&&c(t.jsxs("div",{children:[t.jsx(f,{size:"lg",color:"primaryText",children:"Fees"}),t.jsx(l,{y:"lg"}),t.jsx(Et,{quote:d.data})]}))}function m(F){const I="Unable to get price quote";try{if(F.error.code==="MINIMUM_PURCHASE_AMOUNT"){const M=F.error;return[`Minimum purchase amount is $${M.data.minimumAmountUSDCents/100}`,`Requested amount is $${M.data.requestedAmountUSDCents/100}`]}}catch{}return[I]}const S=!d.data;return t.jsxs(u,{px:"lg",flex:"column",gap:"md",children:[t.jsxs("div",{children:[t.jsx(Nt,{isLoading:d.isLoading,value:(C=d.data)==null?void 0:C.fromCurrencyWithFees.amount,client:o,currency:b,onSelectCurrency:x,disableCurrencySelection:!0}),t.jsx(qe,{quoteIsLoading:d.isLoading,estimatedSeconds:(T=d.data)==null?void 0:T.estimatedDurationSeconds,onViewFees:B})]}),d.error&&t.jsx("div",{children:m(d.error).map(F=>t.jsx(f,{color:"danger",size:"sm",center:!0,multiline:!0,children:F},F))}),t.jsx(D,{variant:S?"outline":"accent","data-disabled":S,disabled:S,fullWidth:!0,onClick:j,gap:"xs",children:d.isLoading?t.jsxs(t.Fragment,{children:[t.jsx(te,{size:"sm",color:"accentText"}),"Getting price quote"]}):"Continue"})]})}function en(e){const n=ne(e.buyForTx.tx.chain);return t.jsxs(u,{children:[t.jsx(l,{y:"xs"}),t.jsxs(u,{flex:"row",style:{justifyContent:"space-between"},children:[t.jsx(f,{size:"sm",children:"Amount Needed"}),t.jsxs(u,{flex:"column",style:{alignItems:"flex-end"},children:[t.jsxs(u,{flex:"row",gap:"xs",center:"y",children:[t.jsxs(f,{color:"primaryText",size:"sm",children:[e.amountNeeded," ",e.buyForTx.tokenSymbol]}),t.jsx(Y,{chain:e.buyForTx.tx.chain,client:e.client,size:"sm",token:H})]}),t.jsx(l,{y:"xxs"}),n.data?t.jsxs(f,{size:"sm",children:[" ",n.data.name]}):t.jsx(q,{height:R.sm,width:"50px"})]})]}),t.jsx(l,{y:"md"}),t.jsx(Be,{}),t.jsx(l,{y:"md"}),t.jsxs(u,{flex:"row",style:{justifyContent:"space-between"},children:[t.jsx(f,{size:"sm",children:"Your Balance"}),t.jsxs(u,{flex:"row",gap:"xs",children:[t.jsxs(f,{color:"primaryText",size:"sm",children:[V(Number(G(e.buyForTx.balance)),4)," ",e.buyForTx.tokenSymbol]}),t.jsx(Y,{chain:e.buyForTx.tx.chain,client:e.client,size:"sm",token:H})]})]}),t.jsx(l,{y:"md"}),t.jsx(Be,{}),t.jsx(l,{y:"lg"}),t.jsx(f,{center:!0,size:"sm",children:"Purchase"}),t.jsx(l,{y:"xxs"})]})}function We(e,n,s){const i={},o=n.buyWithFiat===!1,a=n.buyWithCrypto===!1;for(const c of e)i[c.chain.id]=c.tokens.filter(h=>h.buyWithCryptoEnabled&&h.buyWithFiatEnabled?!0:!(!h.buyWithCryptoEnabled&&o||!h.buyWithFiatEnabled&&a));if(s)for(const c in s){const h=Number(c),x=s[h];x&&(i[h]=x)}return i}function ve(e){return t.jsx(kt,{client:e.client,connectLocale:e.connectLocale,showTabs:!1,onBack:e.showMainScreen,chains:e.chains,closeModal:e.showMainScreen,networkSelector:{renderChain(n){return t.jsx(Ft,{chain:n.chain,confirming:!1,switchingFailed:!1,onClick:()=>{e.setChain(n.chain),e.showMainScreen()},client:e.client,connectLocale:e.connectLocale})}}})}export{nn as default};

import{B as U,f as H,a as E,h as x,k as W,l as O,_ as k,c as F,n as y,m as _,o as Q,p as V,q as $,r as M,t as J,d as B,e as z,g as K}from"./index-e9bc3d71.js";import{n as q,g as Y}from"./normalizeChainId-f7b13ce6.js";import{g as w}from"./defaultDappMetadata-253fba14.js";import{g as G,v as X}from"./typedData-11377c8a.js";import"./regex-88e9c765.js";const Z=(e,t,a)=>JSON.stringify(e,(s,n)=>{const i=typeof n=="bigint"?n.toString():n;return typeof t=="function"?t(s,i):i},a);class ee extends U{constructor({body:t,error:a,url:s}){super("RPC Request failed.",{cause:a,details:a.message,metaMessages:[`URL: ${H(s)}`,`Request body: ${Z(t)}`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=a.code}}const ne=-1;class ae extends U{constructor(t,{code:a,docsPath:s,metaMessages:n,shortMessage:i}){super(i,{cause:t,docsPath:s,metaMessages:n||(t==null?void 0:t.metaMessages)}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=t.name,this.code=t instanceof ee?t.code:a??ne}}class j extends ae{constructor(t,a){super(t,a),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"ProviderRpcError"}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=a.data}}class I extends j{constructor(t){super(t,{code:I.code,shortMessage:"User rejected the request."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"UserRejectedRequestError"})}}Object.defineProperty(I,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class P extends j{constructor(t){super(t,{code:P.code,shortMessage:"An error occurred when attempting to switch chain."}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"SwitchChainError"})}}Object.defineProperty(P,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});const l=typeof window<"u"?Q:void 0,te="08c4b07e3ad25f1a27c14a4e8cecb6f0",D="eip155",N="wallet_addEthereumChain",se=!0,v={requestedChains:"tw.wc.requestedChains",lastUsedChainId:"tw.wc.lastUsedChainId"};function me(e){return e.id==="walletConnect"}async function pe(e,t,a){var h,f,p;const s=await S(e,a),n=e.walletConnect,{onDisplayUri:i}=n||{};i&&i&&s.events.addListener("display_uri",i);const{rpcMap:o,chainsToRequest:u}=L({client:e.client,chain:e.chain,optionalChains:(h=e.walletConnect)==null?void 0:h.optionalChains});s.session&&await s.connect({...n!=null&&n.pairingTopic?{pairingTopic:n==null?void 0:n.pairingTopic}:{},optionalChains:u,rpcMap:o}),T(u);const r=(await s.enable())[0];if(!r)throw new Error("No accounts found on provider.");const c=q(s.chainId),m=e.chain&&e.chain.id===c?e.chain:E(c);if(e){const C={optionalChains:(f=e.walletConnect)==null?void 0:f.optionalChains,chain:e.chain,pairingTopic:(p=e.walletConnect)==null?void 0:p.pairingTopic};l&&x(l,a,C)}return n!=null&&n.onDisplayUri&&s.events.removeListener("display_uri",n.onDisplayUri),A(r,m,s,t)}async function ge(e,t,a){const s=l?await W(l,a):null,n=await S(s?{chain:s.chain,client:e.client,walletConnect:{pairingTopic:s.pairingTopic,optionalChains:s.optionalChains}}:{client:e.client,walletConnect:{}},a,!0),i=n.accounts[0];if(!i)throw new Error("No accounts found on provider.");const o=q(n.chainId),u=e.chain&&e.chain.id===o?e.chain:E(o);return A(i,u,n,t)}async function S(e,t,a=!1){var m,h,f,p,C;const s=await O(t),n=e.walletConnect,{EthereumProvider:i,OPTIONAL_EVENTS:o,OPTIONAL_METHODS:u}=await k(()=>import("./index.es-cd7e6124.js"),["assets/index.es-cd7e6124.js","assets/index-e9bc3d71.js","assets/index-1b569fdb.css","assets/index-ddff69df.js"]),{rpcMap:d,chainsToRequest:r}=L({client:e.client,chain:e.chain,optionalChains:(m=e.walletConnect)==null?void 0:m.optionalChains}),c=await i.init({showQrModal:(n==null?void 0:n.showQrModal)===void 0?se:n.showQrModal,projectId:(n==null?void 0:n.projectId)||te,optionalMethods:u,optionalEvents:o,optionalChains:r,metadata:{name:((h=n==null?void 0:n.appMetadata)==null?void 0:h.name)||w().name,description:((f=n==null?void 0:n.appMetadata)==null?void 0:f.description)||w().description,url:((p=n==null?void 0:n.appMetadata)==null?void 0:p.url)||w().url,icons:[((C=n==null?void 0:n.appMetadata)==null?void 0:C.logoUrl)||w().logoUrl]},rpcMap:d,qrModalOptions:n==null?void 0:n.qrModalOptions,disableProviderPing:!0});if(c.events.setMaxListeners(Number.POSITIVE_INFINITY),a||c.session&&await c.disconnect(),t!=="walletConnect"){let g=function(){if(typeof window>"u"||!V())return;const b=s.mobile.universal||s.mobile.native,R=s.mobile.native||s.mobile.universal;$()?b&&M(b):J()?R&&M(R):b&&M(b)};c.signer.client.on("session_request_sent",g),c.events.addListener("disconnect",()=>{c.signer.client.off("session_request_sent",g)})}return c}function A(e,t,a,s){const n={address:e,async sendTransaction(r){return{transactionHash:await a.request({method:"eth_sendTransaction",params:[{gas:r.gas?y(r.gas):void 0,value:r.value?y(r.value):void 0,from:this.address,to:r.to,data:r.data}]})}},async signMessage({message:r}){return a.request({method:"personal_sign",params:[r,this.address]})},async signTypedData(r){const{domain:c,message:m,primaryType:h}=r,f={EIP712Domain:G({domain:c}),...r.types};X({domain:c,message:m,primaryType:h,types:f});const p=B({domain:c??{},message:m,primaryType:h,types:f},(C,g)=>z(g)?g.toLowerCase():g);return await a.request({method:"eth_signTypedData_v4",params:[this.address,p]})}};async function i(){a.removeListener("accountsChanged",u),a.removeListener("chainChanged",d),a.removeListener("disconnect",o),await a.disconnect()}function o(){T([]),l==null||l.removeItem(v.lastUsedChainId),i(),s.emit("disconnect",void 0)}function u(r){if(r[0]){const c={...n,address:K(r[0])};s.emit("accountChanged",c),s.emit("accountsChanged",r)}else o()}function d(r){const c=E(q(r));s.emit("chainChanged",c),l==null||l.setItem(v.lastUsedChainId,String(r))}return a.on("accountsChanged",u),a.on("chainChanged",d),a.on("disconnect",o),a.on("session_delete",o),[n,t,i,r=>ce(a,r)]}function ie(e){var t,a;return((a=(t=e.session)==null?void 0:t.namespaces[D])==null?void 0:a.methods)||[]}function re(e){var a,s,n;return((n=(s=(a=e.session)==null?void 0:a.namespaces[D])==null?void 0:s.chains)==null?void 0:n.map(i=>Number.parseInt(i.split(":")[1]||"")))??[]}async function ce(e,t){var s,n;const a=t.id;try{const i=re(e),o=ie(e);if(!i.includes(a)&&o.includes(N)){const d=await F(t);await e.request({method:N,params:[{chainId:y(d.chainId),chainName:d.name,nativeCurrency:d.nativeCurrency,rpcUrls:Y(d),blockExplorerUrls:((s=t.blockExplorers)==null?void 0:s.slice(0,1))||((n=d.explorers)==null?void 0:n.slice(0,1))||[]}]});const r=await oe();r.push(a),T(r)}await e.request({method:"wallet_switchEthereumChain",params:[{chainId:y(a)}]})}catch(i){const o=typeof i=="string"?i:i==null?void 0:i.message;throw/user rejected request/i.test(o)?new I(i):new P(i)}}function T(e){localStorage==null||localStorage.setItem(v.requestedChains,JSON.stringify(e))}async function oe(){const e=localStorage.getItem(v.requestedChains);return e?JSON.parse(e):[]}function L(e){const t={};e.chain&&(t[e.chain.id]=_({chain:e.chain,client:e.client}));const a=((e==null?void 0:e.optionalChains)||[]).slice(0,10);for(const i of a)t[i.id]=_({chain:i,client:e.client});const s=a.map(i=>i.id)||[],n=e.chain?[e.chain.id,...s]:s.length>0?s:[1];return{rpcMap:t,chainsToRequest:n}}export{ge as autoConnectWC,pe as connectWC,me as isWalletConnect};

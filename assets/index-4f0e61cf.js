import{K as D,bX as v,_ as W}from"./index-1ebb32ef.js";var _;(function(e){e.USER_MANAGED="USER_MANAGED",e.CLOUD_MANAGED="AWS_MANAGED"})(_||(_={}));var u;(function(e){e.COGNITO="Cognito",e.GOOGLE="Google",e.EMAIL_OTP="EmailOtp",e.CUSTOM_JWT="CustomJWT",e.CUSTOM_AUTH_ENDPOINT="CustomAuthEndpoint",e.FACEBOOK="Facebook",e.APPLE="Apple",e.PASSKEY="Passkey"})(u||(u={}));var m;(function(e){e.LOGGED_OUT="Logged Out",e.LOGGED_IN_WALLET_UNINITIALIZED="Logged In, Wallet Uninitialized",e.LOGGED_IN_NEW_DEVICE="Logged In, New Device",e.LOGGED_IN_WALLET_INITIALIZED="Logged In, Wallet Initialized"})(m||(m={}));function S(e){return Uint8Array.from(e,t=>t.charCodeAt(0)).buffer}function K(e){return String.fromCharCode(...new Uint8Array(e))}function L(e){return e.match(/^[a-zA-Z0-9\-_]+=*$/)!==null}function l(e){return btoa(K(e)).replaceAll("+","-").replaceAll("/","_")}function p(e){return e=e.replaceAll("-","+").replaceAll("_","/"),S(atob(e))}async function U(e){return await crypto.subtle.digest("SHA-256",e)}function T(){return!!window.PublicKeyCredential}async function C(){return await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()}async function G(e){if(e==="local")return"platform";if(e==="roaming"||e==="extern")return"cross-platform";if(e!=="both")try{return await C()?"platform":"cross-platform"}catch{return}}function R(e){switch(e){case-7:return"ES256";case-257:return"RS256";default:throw new Error(`Unknown algorithm code: ${e}`)}}async function $(e,t,a){if(a=a??{},!L(t))throw new Error("Provided challenge is not properly encoded in Base64url");const n={challenge:p(t),rp:{id:a.domain??window.location.hostname,name:a.domain??window.location.hostname},user:{id:a.userHandle?S(a.userHandle):await U(new TextEncoder().encode("passwordless.id-user:"+e)),name:e,displayName:e},pubKeyCredParams:[{alg:-7,type:"public-key"},{alg:-257,type:"public-key"}],timeout:a.timeout??6e4,authenticatorSelection:{userVerification:a.userVerification??"required",authenticatorAttachment:await G(a.authenticatorType??"auto"),residentKey:a.discoverable??"preferred",requireResidentKey:a.discoverable==="required"},attestation:"direct"};a.debug&&console.debug(n);const i=await navigator.credentials.create({publicKey:n});a.debug&&console.debug(i);const r=i.response;let o={username:e,credential:{id:i.id,publicKey:l(r.getPublicKey()),algorithm:R(i.response.getPublicKeyAlgorithm())},authenticatorData:l(r.getAuthenticatorData()),clientData:l(r.clientDataJSON)};return a.attestation&&(o.attestationData=l(r.attestationObject)),o}async function V(e){const t=["internal"],a=["hybrid","usb","ble","nfc"];if(e==="local")return t;if(e=="roaming"||e==="extern")return a;if(e==="both")return[...t,...a];try{return await C()?t:a}catch{return[...t,...a]}}async function M(e,t,a){if(a=a??{},!L(t))throw new Error("Provided challenge is not properly encoded in Base64url");const n=await V(a.authenticatorType??"auto");let i={challenge:p(t),rpId:a.domain??window.location.hostname,allowCredentials:e.map(s=>({id:p(s),type:"public-key",transports:n})),userVerification:a.userVerification??"required",timeout:a.timeout??6e4};a.debug&&console.debug(i);let r=await navigator.credentials.get({publicKey:i,mediation:a.mediation});a.debug&&console.debug(r);const o=r.response;return{credentialId:r.id,authenticatorData:l(o.authenticatorData),clientData:l(o.clientDataJSON),signature:l(o.signature),userHandle:o.userHandle?l(o.userHandle):void 0}}new TextDecoder("utf-8");const Q="/sdk/2022-08-12/embedded-wallet",h=e=>`thirdwebEwsWalletUserId-${e}`,j="walletToken",f=e=>`${j}-${e}`,b=e=>`passkey-credential-id-${e}`,H="a",w=(e,t)=>`${H}-${e}-${t}`,O=new Map;class y{constructor({clientId:t}){Object.defineProperty(this,"isSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.isSupported=typeof window<"u"&&!!window.localStorage,this.clientId=t}async getItem(t){return this.isSupported?window.localStorage.getItem(t):O.get(t)??null}async setItem(t,a){if(this.isSupported)return window.localStorage.setItem(t,a);O.set(t,a)}async removeItem(t){const a=await this.getItem(t);return this.isSupported&&a?(window.localStorage.removeItem(t),!0):!1}async savePasskeyCredentialId(t){await this.setItem(b(this.clientId),t)}async getPasskeyCredentialId(){return this.getItem(b(this.clientId))}async saveAuthCookie(t){await this.setItem(f(this.clientId),t)}async getAuthCookie(){return this.getItem(f(this.clientId))}async removeAuthCookie(){return this.removeItem(f(this.clientId))}async saveDeviceShare(t,a){await this.saveWalletUserId(a),await this.setItem(w(this.clientId,a),t)}async getDeviceShare(){const t=await this.getWalletUserId();return t?this.getItem(w(this.clientId,t)):null}async removeDeviceShare(){const t=await this.getWalletUserId();return t?this.removeItem(w(this.clientId,t)):!1}async getWalletUserId(){return this.getItem(h(this.clientId))}async saveWalletUserId(t){await this.setItem(h(this.clientId),t)}async removeWalletUserId(){return this.removeItem(h(this.clientId))}}function N(){return`${v("inAppWallet")}/api/2024-05-05/login/passkey/callback`}function P(e,t){return`${v("inAppWallet")}/api/2024-05-05/login/passkey?type=${e}${t?`&username=${t}`:""}`}async function B(e){if(!T())throw new Error("Passkeys are not available on this device");const t=new y({clientId:e.client.clientId}),a=D(e.client),n=e.username??J(),r=await(await a(P("sign-up",n))).json();if(!r.challenge)throw new Error("No challenge received");const o=r.challenge,c=await $(n,o,{authenticatorType:e.authenticatorType??"auto",userVerification:"required",attestation:!0,debug:!1});await t.savePasskeyCredentialId(c.credential.id);const d=await(await a(N(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"sign-up",authenticatorData:c.authenticatorData,credentialId:c.credential.id,serverVerificationId:r.serverVerificationId,clientData:c.clientData,username:n,credential:{publicKey:c.credential.publicKey,algorithm:c.credential.algorithm}})})).json();if(!d)throw new Error("No token received");return d}async function q(e){if(!T())throw new Error("Passkeys are not available on this device");const t=new y({clientId:e.client.clientId}),a=D(e.client),i=await(await a(P("sign-in"))).json();if(!i.challenge)throw new Error("No challenge received");const r=i.challenge,o=await t.getPasskeyCredentialId(),s=await M(o?[o]:[],r,{authenticatorType:e.authenticatorType??"auto",userVerification:"required"}),d=await a(N(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"sign-in",authenticatorData:s.authenticatorData,credentialId:s.credentialId,serverVerificationId:i.serverVerificationId,clientData:s.clientData,signature:s.signature})});await t.savePasskeyCredentialId(s.credentialId);const E=await d.json();if(!E)throw new Error("No token received");return E}async function ee(e){return!!await new y({clientId:e.clientId}).getPasskeyCredentialId()}function J(){return`wallet-${new Date().toISOString()}`}const g=new WeakMap;async function I(e){if(g.has(e))return g.get(e);const{InAppWalletSdk:t}=await W(()=>import("./in-app-wallet-443ffd59.js"),["./in-app-wallet-443ffd59.js","./index-1ebb32ef.js","./index-b446a0d4.css"],import.meta.url),a=new t({client:e});return g.set(e,a),a}async function A(e){const{client:t}=e,n=await(await I(t)).getUser();switch(n.status){case m.LOGGED_IN_WALLET_INITIALIZED:return n}}async function x(e){const t=await A(e);if(t&&"email"in t.authDetails)return t.authDetails.email}async function F(e){const t=await A(e);if(t&&"phoneNumber"in t.authDetails)return t.authDetails.phoneNumber}async function z(e){const t=await I(e.client),a=e.strategy;switch(a){case"email":return t.auth.sendEmailLoginOtp({email:e.email});case"phone":return t.auth.sendSmsLoginOtp({phoneNumber:e.phoneNumber});default:k(a,`Provider: ${a} doesnt require pre-authentication`)}}async function Z(e){const t=await I(e.client),a=e.strategy;switch(a){case"email":return await t.auth.verifyEmailLoginOtp({email:e.email,otp:e.verificationCode});case"phone":return await t.auth.verifySmsLoginOtp({otp:e.verificationCode,phoneNumber:e.phoneNumber});case"apple":case"facebook":case"google":{const n=X[a];return t.auth.loginWithOauth({oauthProvider:n,closeOpenedWindow:e.closeOpenedWindow,openedWindow:e.openedWindow})}case"jwt":return t.auth.loginWithCustomJwt({jwt:e.jwt,encryptionKey:e.encryptionKey});case"auth_endpoint":return t.auth.loginWithCustomAuthEndpoint({payload:e.payload,encryptionKey:e.encryptionKey});case"iframe_email_verification":return t.auth.loginWithEmailOtp({email:e.email});case"iframe":return t.auth.loginWithModal();case"passkey":{if(e.type==="sign-up"){const i=await B({client:e.client,authenticatorType:e.authenticatorType,username:e.passkeyName});return t.auth.loginWithAuthToken(i)}const n=await q({client:e.client,authenticatorType:e.authenticatorType});return t.auth.loginWithAuthToken(n)}default:k(a)}}function k(e,t){throw new Error(t??`Invalid param: ${e}`)}const X={google:u.GOOGLE,facebook:u.FACEBOOK,apple:u.APPLE},te=Object.freeze(Object.defineProperty({__proto__:null,authenticate:Z,getAuthenticatedUser:A,getUserEmail:x,getUserPhoneNumber:F,preAuthenticate:z},Symbol.toStringTag,{value:"Module"}));export{u as A,Q as I,y as L,m as U,ee as h,te as i,z as p};

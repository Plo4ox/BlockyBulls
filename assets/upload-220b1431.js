import{bN as A,c as j,_,bO as E}from"./index-1ebb32ef.js";import{i as s,b as F}from"./uint8-array-0bc57be6.js";function m(e){return globalThis.File&&e instanceof File}function u(e){return!e||!A(e,["data","name"])?!1:!!(typeof e.name=="string"&&(typeof e.data=="string"||s(e.data)))}function S(e,t){if(m(e)&&m(t)){if(e.name===t.name&&e.lastModified===t.lastModified&&e.size===t.size)return!0}else{if(s(e)&&s(t))return F(e,t);if(u(e)&&u(t)&&e.name===t.name){if(typeof e.data=="string"&&typeof t.data=="string")return e.data===t.data;if(s(e.data)&&s(t.data))return F(e.data,t.data)}}return!1}function $(e,t,r){const n=new Map,c=[];for(let a=0;a<t.length;a++){const i=t[a];let f="",l=i;if(m(i))if(r!=null&&r.rewriteFileNames){let N="";if(i.name){const o=i.name.lastIndexOf(".");o>-1&&(N=i.name.substring(o))}f=`${a+r.rewriteFileNames.fileStartNumber}${N}`}else f=`${i.name}`;else u(i)?(l=i.data,r!=null&&r.rewriteFileNames?f=`${a+r.rewriteFileNames.fileStartNumber}`:f=`${i.name}`):r!=null&&r.rewriteFileNames?f=`${a+r.rewriteFileNames.fileStartNumber}`:f=`${a}`;const O=r!=null&&r.uploadWithoutDirectory?"files":`files/${f}`;if(n.has(f)){if(S(n.get(f),i)){c.push(f);continue}throw new Error(`[DUPLICATE_FILE_NAME_ERROR] File name ${f} was passed for more than one different file.`)}n.set(f,i),c.push(f),e.append("file",new Blob([l]),O)}const h={name:"Storage SDK",keyvalues:{...r==null?void 0:r.metadata}};return e.append("pinataMetadata",JSON.stringify(h)),r!=null&&r.uploadWithoutDirectory&&e.append("pinataOptions",JSON.stringify({wrapWithDirectory:!1})),{form:e,fileNames:c.map(a=>encodeURIComponent(a))}}function y(e){return m(e)||s(e)||u(e)}function b(e,t=[]){if(y(e))return t.push(e),t;if(typeof e=="object"){if(!e)return t;if(Array.isArray(e))for(const r of e)b(r,t);else Object.keys(e).map(r=>b(e[r],t))}return t}function g(e,t){if(y(e)){if(t.length)return t.shift();console.warn("Not enough URIs to replace all files in object.")}return typeof e=="object"?e&&(Array.isArray(e)?e.map(r=>g(r,t)):Object.fromEntries(Object.entries(e).map(([r,n])=>[r,g(n,t)]))):e}function d(e){return e.includes("/ipfs/")?`ipfs://${e.split("/ipfs/")[1]}`:e}function w(e){return typeof e=="string"?d(e):typeof e=="object"?!e||y(e)?e:Array.isArray(e)?e.map(t=>w(t)):Object.fromEntries(Object.entries(e).map(([t,r])=>[t,w(r)])):e}async function D(e){if(e.files.length===0)return null;const t=e.files.map(i=>y(i)||typeof i=="string").every(i=>!!i);let r;if(t)r=e.files;else{let i=e.files;i=w(i);const f=b(i);if(f.length){const l=await D({...e,files:f});i=g(i,Array.isArray(l)?l:[l])}r=i.map(l=>typeof l=="string"?l:j(l))}const n=new FormData,{fileNames:c,form:h}=$(n,r,e),a=E();if(a==="browser"||a==="node"){const{uploadBatch:i}=await _(()=>import("./web-node-5d80ed79.js"),["./web-node-5d80ed79.js","./index-1ebb32ef.js","./index-b446a0d4.css"],import.meta.url),f=await i(e.client,h,c,e);return e.files.length===1?f[0]:f}throw new Error("Please, use the uploadMobile function in mobile environments.")}export{D as upload};

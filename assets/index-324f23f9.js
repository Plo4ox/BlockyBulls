import{v as k,w as ie,x as oe,y as _,A as ce,z as v,C as D,D as G,E as z,F as de,G as J,H as Y,I as K,J as q,K as ue,P as pe,L as x,M as le,B as fe,N as M,O as me,Q as ye,n as he,e as ge,S as Ae,T,U as we,V as Q,W as X,X as w,Y as ve,s as Z,Z as be,$ as I,a0 as Te,a1 as Oe,a2 as ee,a3 as _e,a4 as S,a5 as xe,a6 as Ee,a7 as Pe,a8 as b,a9 as V,aa as De,_ as A,ab as R}from"./index-a1562f4e.js";import{g as Ge,v as Ie}from"./typedData-4074829a.js";const L=k;function Le(n){const{abi:e,args:t=[],name:r}=n,a=ie(r,{strict:!1}),i=e.filter(o=>a?o.type==="function"?oe(o)===r:o.type==="event"?L(o)===r:!1:"name"in o&&o.name===r);if(i.length===0)return;if(i.length===1)return i[0];let s;for(const o of i){if(!("inputs"in o))continue;if(!t||t.length===0){if(!o.inputs||o.inputs.length===0)return o;continue}if(!o.inputs||o.inputs.length===0||o.inputs.length!==t.length)continue;if(t.every((c,u)=>{const m="inputs"in o&&o.inputs[u];return m?E(c,m):!1})){if(s&&"inputs"in s&&s.inputs){const c=te(o.inputs,s.inputs,t);if(c)throw new ce({abiItem:o,type:c[0]},{abiItem:s,type:c[1]})}s=o}}return s||i[0]}function E(n,e){const t=typeof n,r=e.type;switch(r){case"address":return _(n,{strict:!1});case"bool":return t==="boolean";case"function":return t==="string";case"string":return t==="string";default:return r==="tuple"&&"components"in e?Object.values(e.components).every((a,i)=>E(Object.values(n)[i],a)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(r)?t==="number"||t==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(r)?t==="string"||n instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(r)?Array.isArray(n)&&n.every(a=>E(a,{...e,type:r.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function te(n,e,t){for(const r in n){const a=n[r],i=e[r];if(a.type==="tuple"&&i.type==="tuple"&&"components"in a&&"components"in i)return te(a.components,i.components,t[r]);const s=[a.type,i.type];if((()=>s.includes("address")&&s.includes("bytes20")?!0:s.includes("address")&&s.includes("string")?_(t[r],{strict:!1}):s.includes("address")&&s.includes("bytes")?_(t[r],{strict:!1}):!1)())return s}}function Ce(n){const{domain:e={},message:t,primaryType:r}=n,a={EIP712Domain:Ge({domain:e}),...n.types};Ie({domain:e,message:t,primaryType:r,types:a});const i=["0x1901"];return e&&i.push(Ue({domain:e,types:a})),r!=="EIP712Domain"&&i.push(ne({data:t,primaryType:r,types:a})),v(D(i))}function Ue({domain:n,types:e}){return ne({data:n,primaryType:"EIP712Domain",types:e})}function ne({data:n,primaryType:e,types:t}){const r=re({data:n,primaryType:e,types:t});return v(r)}function re({data:n,primaryType:e,types:t}){const r=[{type:"bytes32"}],a=[Me({primaryType:e,types:t})];for(const i of t[e]){const[s,o]=se({types:t,name:i.name,type:i.type,value:n[i.name]});r.push(s),a.push(o)}return G(r,a)}function Me({primaryType:n,types:e}){const t=z(Se({primaryType:n,types:e}));return v(t)}function Se({primaryType:n,types:e}){let t="";const r=ae({primaryType:n,types:e});r.delete(n);const a=[n,...Array.from(r).sort()];for(const i of a)t+=`${i}(${e[i].map(({name:s,type:o})=>`${o} ${s}`).join(",")})`;return t}function ae({primaryType:n,types:e},t=new Set){const r=n.match(/^\w*/u),a=r==null?void 0:r[0];if(t.has(a)||e[a]===void 0)return t;t.add(a);for(const i of e[a])ae({primaryType:i.type,types:e},t);return t}function se({types:n,name:e,type:t,value:r}){if(n[t]!==void 0)return[{type:"bytes32"},v(re({data:r,primaryType:t,types:n}))];if(t==="bytes")return r=`0x${(r.length%2?"0":"")+r.slice(2)}`,[{type:"bytes32"},v(r)];if(t==="string")return[{type:"bytes32"},v(z(r))];if(t.lastIndexOf("]")===t.length-1){const a=t.slice(0,t.lastIndexOf("[")),i=r.map(s=>se({name:e,type:a,types:n,value:s}));return[{type:"bytes32"},v(G(i.map(([s])=>s),i.map(([,s])=>s)))]}return[{type:t},r]}const $="/docs/contract/decodeEventLog";function Ve(n){const{abi:e,data:t,strict:r,topics:a}=n,i=r??!0,[s,...o]=a;if(!s)throw new de({docsPath:$});const p=e.find(l=>l.type==="event"&&s===L(J(l)));if(!(p&&"name"in p)||p.type!=="event")throw new Y(s,{docsPath:$});const{name:c,inputs:u}=p,m=u==null?void 0:u.some(l=>!("name"in l&&l.name));let d=m?[]:{};const y=u.filter(l=>"indexed"in l&&l.indexed);for(let l=0;l<y.length;l++){const h=y[l],g=o[l];if(!g)throw new K({abiItem:p,param:h});d[m?l:h.name||l]=Re({param:h,value:g})}const f=u.filter(l=>!("indexed"in l&&l.indexed));if(f.length>0){if(t&&t!=="0x")try{const l=q(f,t);if(l)if(m)d=[...d,...l];else for(let h=0;h<f.length;h++)d[f[h].name]=l[h]}catch(l){if(i)throw l instanceof ue||l instanceof pe?new x({abiItem:p,data:t,params:f,size:le(t)}):l}else if(i)throw new x({abiItem:p,data:"0x",params:f,size:0})}return{eventName:c,args:Object.values(d).length>0?d:void 0}}function Re({param:n,value:e}){return n.type==="string"||n.type==="bytes"||n.type==="tuple"||n.type.match(/^(.*)\[(\d+)?\]$/)?e:(q([n],e)||[])[0]}class $e extends fe{constructor(e){super(`Filter type "${e}" is not supported.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"FilterTypeNotSupportedError"})}}const H="/docs/contract/encodeEventTopics";function He(n){var p;const{abi:e,eventName:t,args:r}=n;let a=e[0];if(t){const c=Le({abi:e,name:t});if(!c)throw new M(t,{docsPath:H});a=c}if(a.type!=="event")throw new M(void 0,{docsPath:H});const i=J(a),s=L(i);let o=[];if(r&&"inputs"in a){const c=(p=a.inputs)==null?void 0:p.filter(m=>"indexed"in m&&m.indexed),u=Array.isArray(r)?r:Object.values(r).length>0?(c==null?void 0:c.map(m=>r[m.name]))??[]:[];u.length>0&&(o=(c==null?void 0:c.map((m,d)=>Array.isArray(u[d])?u[d].map((y,f)=>F({param:m,value:u[d][f]})):u[d]?F({param:m,value:u[d]}):null))??[])}return[s,...o]}function F({param:n,value:e}){if(n.type==="string"||n.type==="bytes")return v(me(e));if(n.type==="tuple"||n.type.match(/^(.*)\[(\d+)?\]$/))throw new $e(n.type);return G([n],[e])}function Fe({abi:n,eventName:e,logs:t,strict:r=!0}){return t.map(a=>{var i;try{const s=Ve({...a,abi:n,strict:r});return e&&!e.includes(s.eventName)?null:{...s,...a}}catch(s){let o,p;if(s instanceof Y)return null;if(s instanceof x||s instanceof K){if(r)return null;o=s.abiItem.name,p=(i=s.abiItem.inputs)==null?void 0:i.some(c=>!("name"in c&&c.name))}return{...a,args:p?[]:{},eventName:o}}}).filter(Boolean)}function Be(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="event")}function Ne(n){const{signature:e}=n;let t;return Be(e)?t=e:t=ye(e),{abiEvent:t,hash:k(t),topics:He({abi:[t],args:n.filters})}}function je(n){const{logs:e,events:t,strict:r}=n;return Fe({logs:e,abi:t.map(a=>a.abiEvent),strict:r})}function We(n={}){return Ne({signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:n})}const ke=()=>{const n=BigInt(Math.floor(Math.random()*4294967296)),e=BigInt(Math.floor(Math.random()*4294967296)),t=BigInt(Math.floor(Math.random()*4294967296)),r=BigInt(Math.floor(Math.random()*4294967296)),a=BigInt(Math.floor(Math.random()*4294967296)),i=BigInt(Math.floor(Math.random()*4294967296));return n<<BigInt(160)|e<<BigInt(128)|t<<BigInt(96)|r<<BigInt(64)|a<<BigInt(32)|i},ze=()=>BigInt(D([he(ke()),"0x0000000000000000"]));function C(n){return Object.fromEntries(Object.entries(n).map(([e,t])=>[e,ge(t)?t:Ae(t)]))}async function Je(n){var e;return O({...n,operation:"eth_sendUserOperation",params:[C(n.userOp),((e=n.options.overrides)==null?void 0:e.entrypointAddress)??T]})}async function B(n){var t;const e=await O({...n,operation:"eth_estimateUserOperationGas",params:[C(n.userOp),((t=n.options.overrides)==null?void 0:t.entrypointAddress)??T]});return{preVerificationGas:w(e.preVerificationGas),verificationGas:w(e.verificationGas),verificationGasLimit:w(e.verificationGasLimit),callGasLimit:w(e.callGasLimit)+ve}}async function Ye(n){const e=await O({...n,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxPriorityFeePerGas:w(e.maxPriorityFeePerGas),maxFeePerGas:w(e.maxFeePerGas)}}async function Ke(n){var t,r;const e=await O({...n,operation:"eth_getUserOperationReceipt",params:[n.userOpHash]});if(e){if(e.success===!1){const i=(r=(t=je({events:[We()],logs:e.logs})[0])==null?void 0:t.args)==null?void 0:r.revertReason;if(!i)throw new Error(`UserOp failed at txHash: ${e.transactionHash}`);const s=we({data:i});throw new Error(`UserOp failed with reason: '${s.args.join(",")}' at txHash: ${e.transactionHash}`)}return e.receipt}}async function O(n){var p;const{options:e,operation:t,params:r}=n,a=((p=e.overrides)==null?void 0:p.bundlerUrl)??Q(e.chain),s=await X(e.client)(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:t,params:r})}),o=await s.json();if(!s.ok||o.error){let c=o.error||s.statusText;typeof c=="object"&&(c=JSON.stringify(c));const u=o.code||"UNKNOWN";throw new Error(`${t} error: ${c}
Status: ${s.status}
Code: ${u}`)}return o.result}async function qe(n,e){var a,i,s;if((a=e.overrides)!=null&&a.predictAddress)return e.overrides.predictAddress(n);if((i=e.overrides)!=null&&i.accountAddress)return e.overrides.accountAddress;const t=e.personalAccountAddress;if(!t)throw new Error("Account address is required to predict the smart wallet address.");const r=Z(((s=e.overrides)==null?void 0:s.accountSalt)??"");return be({contract:n,method:"function getAddress(address, bytes) returns (address)",params:[t,r]})}function Qe(n){var r,a;const{factoryContract:e,options:t}=n;return(r=t.overrides)!=null&&r.createAccount?t.overrides.createAccount(e):I({contract:e,method:"function createAccount(address, bytes) returns (address)",params:[t.personalAccount.address,Z(((a=t.overrides)==null?void 0:a.accountSalt)??"")]})}function Xe(n){var a;const{accountContract:e,options:t,transaction:r}=n;return(a=t.overrides)!=null&&a.execute?t.overrides.execute(e,r):I({contract:e,method:"function execute(address, uint256, bytes)",params:[r.to||"",r.value||0n,r.data||"0x"]})}function Ze(n){var a;const{accountContract:e,options:t,transactions:r}=n;return(a=t.overrides)!=null&&a.executeBatch?t.overrides.executeBatch(e,r):I({contract:e,method:"function executeBatch(address[], uint256[], bytes[])",params:[r.map(i=>i.to||""),r.map(i=>i.value||0n),r.map(i=>i.data||"0x")]})}async function N(n){var m,d,y,f;const{userOp:e,options:t}=n;if((m=t.overrides)!=null&&m.paymaster)return(d=t.overrides)==null?void 0:d.paymaster(e);const r={"Content-Type":"application/json"},a=t.client,i=Te(t.chain),s=((y=t.overrides)==null?void 0:y.entrypointAddress)??T,p=await X(a)(i,{method:"POST",headers:r,body:JSON.stringify({jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[C(e),s]})}),c=await p.json();if(!p.ok){const l=c.error||p.statusText,h=c.code||"UNKNOWN";throw new Error(`Paymaster error: ${l}
Status: ${p.status}
Code: ${h}`)}if(c.result)return typeof c.result=="string"?{paymasterAndData:c.result}:{paymasterAndData:c.result.paymasterAndData,verificationGasLimit:c.result.verificationGasLimit?w(c.result.verificationGasLimit):void 0,preVerificationGas:c.result.preVerificationGas?w(c.result.preVerificationGas):void 0,callGasLimit:c.result.callGasLimit?w(c.result.callGasLimit):void 0};const u=((f=c.error)==null?void 0:f.message)||c.error||p.statusText||"unknown error";throw new Error(`Paymaster error from ${i}: ${u}`)}async function et(n){var m;const{executeTx:e,options:t}=n,a=await Oe(t.accountContract)?"0x":await nt(t),i=await ee(e);let{maxFeePerGas:s,maxPriorityFeePerGas:o}=e;const p=((m=t.overrides)==null?void 0:m.bundlerUrl)??Q(t.chain);if(_e(p)){const d=await Ye({options:t});s=d.maxFeePerGas,o=d.maxPriorityFeePerGas}else{const[d,y]=await Promise.all([S(s),S(o)]);if(d&&y)s=d,o=y;else{const f=await xe(t.client,t.chain);o=y??f.maxPriorityFeePerGas??0n,s=d??f.maxFeePerGas??0n}}const c=ze(),u={sender:t.accountContract.address,nonce:c,initCode:a,callData:i,maxFeePerGas:s,maxPriorityFeePerGas:o,callGasLimit:0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:Ee};if(t.sponsorGas){const d=await N({userOp:u,options:t}),y=d.paymasterAndData;if(y&&y!=="0x"&&(u.paymasterAndData=y),d.callGasLimit&&d.verificationGasLimit&&d.preVerificationGas)u.callGasLimit=d.callGasLimit,u.verificationGasLimit=d.verificationGasLimit,u.preVerificationGas=d.preVerificationGas;else{const f=await B({userOp:u,options:t});if(u.callGasLimit=f.callGasLimit,u.verificationGasLimit=f.verificationGasLimit,u.preVerificationGas=f.preVerificationGas,y&&y!=="0x"){const l=await N({userOp:u,options:t});l.paymasterAndData&&l.paymasterAndData!=="0x"&&(u.paymasterAndData=l.paymasterAndData)}}}else{const d=await B({userOp:u,options:t});u.callGasLimit=d.callGasLimit,u.verificationGasLimit=d.verificationGasLimit,u.preVerificationGas=d.preVerificationGas}return{...u,signature:"0x"}}async function tt(n){var a;const{userOp:e,options:t}=n,r=rt({userOp:e,entryPoint:((a=t.overrides)==null?void 0:a.entrypointAddress)||T,chainId:t.chain.id});if(t.personalAccount.signMessage){const i=await t.personalAccount.signMessage({message:{raw:Pe(r)}});return{...e,signature:i}}throw new Error("signMessage not implemented in signingAccount")}async function nt(n){const{factoryContract:e}=n,t=Qe({factoryContract:e,options:n});return D([e.address,await ee(t)])}function rt(n){const{userOp:e,entryPoint:t,chainId:r}=n,a=b(e.initCode),i=b(e.callData),s=b(e.paymasterAndData),o=V([{type:"address"},{type:"uint256"},{type:"bytes32"},{type:"bytes32"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"bytes32"}],[e.sender,e.nonce,a,i,e.callGasLimit,e.verificationGasLimit,e.preVerificationGas,e.maxFeePerGas,e.maxPriorityFeePerGas,s]),p=V([{type:"bytes32"},{type:"address"},{type:"uint256"}],[b(o),t,BigInt(r)]);return b(p)}function at(n){return n.id==="smart"}const U=new WeakMap,P=new WeakMap;async function st(n,e,t){const{personalAccount:r,client:a,chain:i}=e;if(!r)throw new Error("Personal wallet does not have an account");const s=t,o=s.factoryAddress??De,p=i??s.chain,c=R({client:a,address:o,chain:p}),u=await qe(c,{personalAccountAddress:r.address,...s}).then(f=>f).catch(()=>{throw new Error(`Failed to get account address with factory contract ${c.address} on chain ID ${p.id}. Are you on the right chain?`)}),m=R({client:a,address:u,chain:p}),d="gasless"in s?s.gasless:s.sponsorGas,y=await ot({...s,chain:p,sponsorGas:d,personalAccount:r,accountContract:m,factoryContract:c,client:a});return U.set(r,n),P.set(n,r),[y,p]}async function it(n){const e=P.get(n);e&&(U.delete(e),P.delete(n))}async function ot(n){const{accountContract:e}=n,t={address:e.address,async sendTransaction(r){const a=Xe({accountContract:e,options:n,transaction:r});return W({executeTx:a,options:n})},async sendBatchTransaction(r){const a=Ze({accountContract:e,options:n,transactions:r});return W({executeTx:a,options:n})},async signMessage({message:r}){const[{isContractDeployed:a},{readContract:i},{encodeAbiParameters:s},{hashMessage:o},{checkContractWalletSignature:p}]=await Promise.all([A(()=>import("./index-a1562f4e.js").then(f=>f.cp),["assets/index-a1562f4e.js","assets/index-d7c118bc.css"]),A(()=>import("./index-a1562f4e.js").then(f=>f.cs),["assets/index-a1562f4e.js","assets/index-d7c118bc.css"]),A(()=>import("./index-a1562f4e.js").then(f=>f.cr),["assets/index-a1562f4e.js","assets/index-d7c118bc.css"]),A(()=>import("./hashMessage-dfc44f87.js"),["assets/hashMessage-dfc44f87.js","assets/index-a1562f4e.js","assets/index-d7c118bc.css"]),A(()=>import("./checkContractWalletSignature-14d0827a.js"),["assets/checkContractWalletSignature-14d0827a.js","assets/isValidSignature-ae9ae454.js","assets/index-a1562f4e.js","assets/index-d7c118bc.css"])]);await a(e)||(console.log("Account contract not deployed yet. Deploying account before signing message"),await j({options:n,account:t,accountContract:e}));const u=o(r);let m=!1;try{await i({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[u]}),m=!0}catch{}let d;if(m){const f=s([{type:"bytes32"}],[u]);d=await n.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:n.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:f}})}else d=await n.personalAccount.signMessage({message:r});if(await p({contract:e,message:r,signature:d}))return d;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async signTypedData(r){var f,l,h;const[{isContractDeployed:a},{readContract:i},{encodeAbiParameters:s},{checkContractWalletSignedTypedData:o}]=await Promise.all([A(()=>import("./index-a1562f4e.js").then(g=>g.cp),["assets/index-a1562f4e.js","assets/index-d7c118bc.css"]),A(()=>import("./index-a1562f4e.js").then(g=>g.cs),["assets/index-a1562f4e.js","assets/index-d7c118bc.css"]),A(()=>import("./index-a1562f4e.js").then(g=>g.cr),["assets/index-a1562f4e.js","assets/index-d7c118bc.css"]),A(()=>import("./checkContractWalletSignedTypedData-3f6bd915.js"),["assets/checkContractWalletSignedTypedData-3f6bd915.js","assets/isValidSignature-ae9ae454.js","assets/index-a1562f4e.js","assets/index-d7c118bc.css","assets/typedData-4074829a.js"])]);if(((l=(f=r.domain)==null?void 0:f.verifyingContract)==null?void 0:l.toLowerCase())===((h=e.address)==null?void 0:h.toLowerCase()))return n.personalAccount.signTypedData(r);await a(e)||(console.log("Account contract not deployed yet. Deploying account before signing message"),await j({options:n,account:t,accountContract:e}));const u=Ce(r);let m=!1;try{await i({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[u]}),m=!0}catch{}let d;if(m){const g=s([{type:"bytes32"}],[u]);d=await n.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:n.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:g}})}else d=await n.personalAccount.signTypedData(r);if(await o({contract:e,data:r,signature:d}))return d;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")}};return t}async function j(n){const{options:e,account:t,accountContract:r}=n,[{sendTransaction:a},{prepareTransaction:i}]=await Promise.all([A(()=>import("./index-a1562f4e.js").then(p=>p.cu),["assets/index-a1562f4e.js","assets/index-d7c118bc.css"]),A(()=>import("./index-a1562f4e.js").then(p=>p.ct),["assets/index-a1562f4e.js","assets/index-d7c118bc.css"])]),s=i({client:e.client,chain:e.chain,to:r.address,value:0n});return await a({transaction:s,account:t})}async function W(n){const{executeTx:e,options:t}=n,r=await et({executeTx:e,options:t}),a=await tt({options:t,userOp:r}),i=await Je({options:t,userOp:a}),s=await ct({options:t,userOpHash:i});return{client:t.client,chain:t.chain,transactionHash:s.transactionHash}}async function ct(n){const{options:e,userOpHash:t}=n,r=12e4,a=1e3,i=Date.now()+r;for(;Date.now()<i;){const s=await Ke({options:e,userOpHash:t});if(s)return s;await new Promise(o=>setTimeout(o,a))}throw new Error("Timeout waiting for userOp to be mined")}const pt=Object.freeze(Object.defineProperty({__proto__:null,connectSmartWallet:st,disconnectSmartWallet:it,isSmartWallet:at,personalAccountToSmartAccountMap:U},Symbol.toStringTag,{value:"Module"}));export{Ce as h,pt as i};
